<% images = [@recipe.image_with_backup, @recipe.image2, @recipe.image3] - [""] %>
<% image_count = images.count %>
<% cache(cache_key(@recipe, "show")) do %>
  <div itemscope itemtype="http://schema.org/Recipe" class="recipe">
    <div class="recipe__sidebar">
      <div class="recipe__recipe">
        <%= @recipe.recipe_as_html %>
      </div>
      <%= render 'shared/mail_card' %>
    </div>
    <div class="recipe__content">
      <div class="recipe__header">
        <div class="recipe__header-content" href="<%= @recipe.url %>">
          <% if image_count >= 2 %>
            <%= list_image(@recipe, "recipe__primary-image recipe__primary-image--2", :image2) %>
          <% end %>
          <h1 class="recipe__header-title" itemprop="name">
            <a href="<%= @recipe.url %>">
              <%= @recipe.name %>
            </a>
          </h1>
          <h2 class="recipe__header-subtitle">
            <%= @recipe.subtitle %>
          </h2>
          <div class="recipe__tag-icons">
            <% @recipe.tags.each do |tag| %>
              <%= render 'tag', tag: tag, classname: "recipe__tag-icon" %>
            <% end %>
          </div>
          <%= display_number_with_fallback(@recipe, "recipe__display-number recipe__display-number--count-#{image_count}") %>
        </div>
        <%= header_image(@recipe, "recipe__primary-image recipe__primary-image--1 recipe__primary-image--1--count-#{image_count}") %>
      </div>
      <div class="recipe__primary" itemprop="description">
        <div class="recipe__description">
          <div class="recipe__cutout recipe__cutout--count-<%= image_count %>"></div>
          <div><%= @recipe.description_to_html %></div>
        </div>
        <div class="recipe__primary-sidebar">
          <%= render 'shared/instagram_card' %>
        </div>
      </div>
    </div>
  </div>
  <div class="recipe__footer">
    <%= render 'shared/ingredient_card', ingredient: @featured_ingredient %>
    <%= render 'list_card', recipe: @recipe %>
  </div>
  <%= render 'footer', :recipe => @recipe %>
<% end %>
